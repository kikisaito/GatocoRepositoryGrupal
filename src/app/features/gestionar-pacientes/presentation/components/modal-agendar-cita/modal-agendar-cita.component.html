<div class="modal-overlay" (click)="onCerrar()">
  <mat-card class="modal-container" (click)="$event.stopPropagation()">
    <mat-card-header class="modal-header">
      <div class="header-content">
        <mat-icon class="cita-icon">event</mat-icon>
        <mat-card-title class="modal-title">Agendar Cita</mat-card-title>
      </div>
    </mat-card-header>
    
    <mat-card-content class="modal-body">
      @if (paciente) {
        <div class="paciente-info">
          <div class="paciente-header">
            <mat-icon class="paciente-icon">pets</mat-icon>
            <span class="paciente-nombre">{{ paciente.nombre }}</span>
          </div>
        </div>

        <div class="form-container">
          <mat-form-field appearance="outline" class="full-width">
            <mat-label>Fecha</mat-label>
            <mat-icon matPrefix>calendar_today</mat-icon>
            <input 
              matInput
              [matDatepicker]="picker"
              [(ngModel)]="fechaSeleccionada"
              (dateChange)="onFechaChange($event.value)"
              [matDatepickerFilter]="dateFilter"
              [min]="fechaMinima"
              readonly
              required>
            <mat-datepicker-toggle matIconSuffix [for]="picker"></mat-datepicker-toggle>
            <mat-datepicker #picker></mat-datepicker>
            @if (fechaSeleccionada) {
              <mat-hint>{{ getFechaFormateada(fechaSeleccionada) }}</mat-hint>
            }
          </mat-form-field>

          <mat-form-field appearance="outline" class="full-width">
            <mat-label>Hora</mat-label>
            <mat-icon matPrefix>schedule</mat-icon>
            <mat-select 
              [(ngModel)]="horaSeleccionada"
              (ngModelChange)="onHoraChange($event)"
              [disabled]="!fechaSeleccionada"
              required>
              <mat-option value="">Selecciona una hora</mat-option>
              @for (hora of horasDisponibles; track hora.value) {
                <mat-option [value]="hora.value">{{ hora.display }}</mat-option>
              }
            </mat-select>
          </mat-form-field>

          @if (error()) {
            <div class="error-message">
              <mat-icon color="warn">error</mat-icon>
              <span>{{ error() }}</span>
            </div>
          }
        </div>
      }
    </mat-card-content>
    
    <mat-card-actions class="modal-footer">
      <button mat-button color="basic" (click)="onCerrar()" [disabled]="isCreating()" class="action-button">
        <mat-icon>close</mat-icon>
        <span>Cancelar</span>
      </button>
      <button mat-raised-button color="primary" (click)="crearCita()" [disabled]="isCreating() || !fechaSeleccionadaString || !horaSeleccionada" class="action-button">
        @if (isCreating()) {
          <mat-spinner diameter="16" class="spinner-inline"></mat-spinner>
          <span>Creando...</span>
        } @else {
          <ng-container class="button-content">
            <mat-icon class="button-icon">check</mat-icon>
            <span class="button-text">Confirmar</span>
          </ng-container>
        }
      </button>
    </mat-card-actions>
  </mat-card>
</div>

